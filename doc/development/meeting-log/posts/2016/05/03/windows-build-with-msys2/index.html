<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Windows build with MSYS2: locally and on Appveyor (now with New Debugging Flavour!)</title>

<link rel="stylesheet" href="../../../../../../../../style.css" type="text/css" />

<link rel="stylesheet" href="../../../../../../../../local.css" type="text/css" />


<link rel="alternate" type="application/x-wiki" title="Edit this page" href="https://github.com/project-renard/project-renard.github.io/edit/source/doc/development/meeting-log/posts/2016/05/03/windows-build-with-msys2.mdwn" />




</head>
<body>

<div class="page">

<div class="pageheader">
<div class="header">
<span>
<span class="parentlinks">

<a href="../../../../../../../../">Project Renard</a>/ 

<a href="../../../../../../../">doc</a>/ 

<a href="../../../../../../">development</a>/ 

<a href="../../../../../">meeting-log</a>/ 

<a href="../../../../">posts</a>/ 

<a href="../../../">2016</a>/ 

<a href="../../">05</a>/ 

<a href="../">03</a>/ 

</span>
<span class="title">
Windows build with MSYS2: locally and on Appveyor (now with New Debugging Flavour!)

</span>
</span>

</div>


<div class="actions">
<ul>

<li><a href="https://github.com/project-renard/project-renard.github.io/edit/source/doc/development/meeting-log/posts/2016/05/03/windows-build-with-msys2.mdwn" rel="nofollow">Edit</a></li>


<li><a href="../../../../../../../../recentchanges/">RecentChanges</a></li>


<li><a href="https://github.com/project-renard/project-renard.github.io/commits/source/doc/development/meeting-log/posts/2016/05/03/windows-build-with-msys2.mdwn">History</a></li>







</ul>
</div>




</div>


<div class="sidebar">
<ul>
    <li><a href="../../../../../../../">Documentation</a></li>
    <ul>
        <li><a href="../../../../../">Development meeting log</a></li>
        <li><a href="../../../../../../">Development</a></li>
        <li><a href="../../../../../../../survey/">Survey</a></li>
        <li><a href="../../../../../../../design/">Design</a></li>
    </ul>
    <li><a href="../../../../../../../../about/">About</a></li>
</ul>

</div>


<div id="pagebody">

<div id="content">
<p>In order to build <a href="https://github.com/project-renard/curie">curie</a> on Windows<a href="#fn:portability" id="fnref:portability" class="footnote">1</a>,
we need to build the various Perl dependencies. These Perl dependencies in turn
require native libraries such as Gtk+ 3 and MuPDF. Using the MSYS2 package manager, we
can install the native libraries and link against them.</p>

<p>The following steps show how to install the dependencies along with how I ended
up debugging the build. I'm writing out this post in case the debugging steps
are useful months later when I forget how or why I did things.</p>

<p>The following will be assuming 64-bit Windows (x86-64
architecture) throughout.</p>

<h2 id="buildinglocally">Building locally</h2>

<ol>

<li>
   Install [MSYS2](https://msys2.github.io/). This is a straightforward install
   into the `C:\msys64` directory.
</li>

<li>
   Start the "MinGW-w64 Win64 Shell" from the Start Menu. This shell sets up
   the proper environment variables needed to use 64-bit libraries for the
   MinGW64 system.
</li>

<li>
   Use the <a href="https://www.archlinux.org/pacman/pacman.8.html">pacman</a> package
   manager to update the package database and install the build toolchain.

   <pre class="hl">   pacman <span class="hl opt">-</span>Syu
   pacman <span class="hl opt">-</span>S <span class="hl opt">--</span>needed <span class="hl opt">--</span>noconfirm mingw<span class="hl opt">-</span>w64<span class="hl opt">-</span>x86_64<span class="hl opt">-</span>toolchain autoconf automake libtool <span class="hl kwc">make patch</span> mingw<span class="hl opt">-</span>w64<span class="hl opt">-</span>x86_64<span class="hl opt">-</span>libtool

</pre>
</li>

<li>
   Install the native dependencies.

   <pre class="hl">   pacman <span class="hl opt">-</span>S <span class="hl opt">--</span>needed <span class="hl opt">--</span>noconfirm \
       mingw<span class="hl opt">-</span>w64<span class="hl opt">-</span>x86_64<span class="hl opt">-</span>gobject<span class="hl opt">-</span>introspection \
       mingw<span class="hl opt">-</span>w64<span class="hl opt">-</span>x86_64<span class="hl opt">-</span>cairo \
       mingw<span class="hl opt">-</span>w64<span class="hl opt">-</span>x86_64<span class="hl opt">-</span>gtk3 \
       mingw<span class="hl opt">-</span>w64<span class="hl opt">-</span>x86_64<span class="hl opt">-</span>expat \
       mingw<span class="hl opt">-</span>w64<span class="hl opt">-</span>x86_64<span class="hl opt">-</span>openssl

</pre>
</li>

<li>
   Install Perl and cpanm

   <pre class="hl">   pacman <span class="hl opt">-</span>S <span class="hl opt">--</span>needed <span class="hl opt">--</span>noconfirm mingw<span class="hl opt">-</span>w64<span class="hl opt">-</span>x86_64<span class="hl opt">-</span>perl
   <span class="hl kwc">yes</span> | cpan App<span class="hl opt">::</span>cpanminus

</pre>

   However, we ecounter a problem with this last command. It tries to using
   `pl2bat.bat` to install the `cpanm` script, but for some reason we see the following error:

   <pre>   Configuring M/MI/MIYAGAWA/App-cpanminus-1.7040.tar.gz with Makefile.PL
   Checking if your kit is complete...
   Looks good
   Generating a dmake-style Makefile
   Writing Makefile for App::cpanminus
   Writing MYMETA.yml and MYMETA.json
     MIYAGAWA/App-cpanminus-1.7040.tar.gz
     C:\msys64\mingw64\bin\perl.exe Makefile.PL -- OK
   Running make for M/MI/MIYAGAWA/App-cpanminus-1.7040.tar.gz
   cp lib/App/cpanminus/fatscript.pm blib\lib\App\cpanminus\fatscript.pm
   cp lib/App/cpanminus.pm blib\lib\App\cpanminus.pm
   "C:\msys64\mingw64\bin\perl.exe" -MExtUtils::Command -e cp -- bin/cpanm blib\script\cpanm
   pl2bat.bat blib\script\cpanm
   'pl2bat.bat' is not recognized as an internal or external command,
   operable program or batch file.
   dmake:  Error code 129, while making 'blib\script\cpanm'
   dmake:  'blib\script\cpanm' removed.
     MIYAGAWA/App-cpanminus-1.7040.tar.gz
     dmake -- NOT OK
   </pre>

   The important line here is

   <pre>   'pl2bat.bat' is not recognized as an internal or external command,
   </pre>

   The `pl2bat` command is a tool that is used on Windows in order to allow for
   running Perl scripts without having to specify that they must run under Perl.
   So instead of having to type `perl myscript` to run code in the `myscript`
   file, we can just type `myscript` and run it as if it was just another
   executable. This works by wrapping the original code and placing it into a
   Windows batch file that calls the Perl interpreter on the same file.

   It turns out that MSYS2 has the Perl script `pl2bat` which does the conversion,
   but that file was not converted itself! To do that we find the path for the
   `pl2bat` file and run `pl2bat` on it.

   <pre class="hl">   pl2bat $<span class="hl opt">(</span><span class="hl kwc">which</span> pl2bat<span class="hl opt">)</span>

</pre>

   We can then install `cpanm` as before.
</li>

<li>
   Install the Perl dependencies for curie itself by running the following the
   `curie` repository:

   <pre class="hl">   cpanm <span class="hl opt">--</span>verbose <span class="hl opt">--</span>installdeps .

</pre>

   This reads the `cpanfile` which lists the Perl prerequisites for the project.
</li>

</ol>

<h2 id="buildingonappveyor">Building on Appveyor</h2>

<div class="footnotes">
<hr />
<ol>

<li id="fn:portability"><p>Portability is important to writing robust software and
eventually curie will have an installer of Windows, so it is best to address
any issues early through continuous integration.<a href="#fnref:portability" class="reversefootnote">&#160;&#8617;</a></p></li>

</ol>
</div>

</div>





</div>

<div id="footer" class="pagefooter">

<div id="pageinfo">









<div class="pagedate">
Last edited <span class="date">Wed 04 May 2016 02:41:31 AM UTC</span>
<!-- Created <span class="date">Tue 03 May 2016 03:47:24 AM UTC</span> -->
</div>

</div>


<!-- from Project Renard -->
</div>

</div>

</body>
</html>
